(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{BjFu:function(e,r,t){"use strict";t.d(r,"a",(function(){return h})),t.d(r,"b",(function(){return b}));var s=t("D57K"),i=t("nsO7"),n=t("wHJ2"),o=t("yC9S"),a=t("Fvsw"),m=t("go4a"),u=t("pjml"),l=t("zdqs"),c=t("SoDU"),p=t("fYJU"),d=t("aHpC"),h="ultra.service.termMembership",b="termMembership",f=function(){function e(e,r,t,s,i,n,a,m,u){var l=this;this.$q=e,this.context=t,this.CourseModel=s,this.CourseMembershipModel=i,this.TermModel=n,this.UserModel=a,this.ExternalCourseModel=m,this.contextUser=u,o.b.OnRootScope(r,"courseUltraStatusChanged",(function(e,r,t){l.updateCourseUltraStatus(r,t)}))}return e.prototype.clear=function(){this.termsAndMemberships=void 0,this.loadPromise=void 0},e.prototype.getTermsAndMemberships=function(){return this.loadPromise?this.loadPromise:this.reloadTermsAndMemberships()},e.prototype.filterMemberships=function(e,r,t){return e&&Array.isArray(e)?e.filter((function(e){return!e.course.isOrganization===r||!!e.course.isOrganization===t})):[]},e.prototype.getCourseMembershipsFromArray=function(e){return this.filterMemberships(e,!0,!1)},e.prototype.getOrganizationMembershipsFromArray=function(e){return this.filterMemberships(e,!1,!0)},e.prototype.parseMembershipFromExternalCourse=function(e){var r=this.CourseMembershipModel.$new();return r.course=this.CourseModel.$new(),r.course.id=e.id,r.course.name=e.title,r.course.description=e.description,r.course.displayName=e.title,r.course.startDate=e.startDate,r.course.endDate=e.endDate,r.course.isAvailable=!0,r.course.durationType=u.o.CourseDuration.DateRange,r.userId=e.userId,r.isAvailable=!0,r.userHasHidden=e.isHidden,r.courseCardColorIndex=parseInt((e.id||"0").replace(/_1$/,"").replace(/[^\d]/g,""),10),r.course.ui={courseColorClass:m.a(r),courseBannerImage:r.getBannerImageFilename(),courseBannerImageThumbnail:r.getBannerImageThumbnailFilename(),isExternal:!0,description:e.description,externalUrl:e.url},r},e.prototype.parseExternalCourseFromMembership=function(e){var r=this.ExternalCourseModel.$new(e.course.id);return r.id=e.course.id,r.title=e.course.name,r.startDate=e.course.startDate,r.endDate=e.course.endDate,r.userId=e.userId,r.description=e.course.ui.description,r.url=e.course.ui.externalUrl,r.isHidden=e.userHasHidden,r},e.prototype.fetchMemberships=function(e){return e.memberships.$fetch({limit:1e4,expand:"course.effectiveAvailability,course.permissions,courseRole"}).$asPromise()},e.prototype.reloadTermsAndMemberships=function(){var e=this,r=this.$q.defer();this.loadPromise=r.promise,this.termsAndMemberships={terms:[],termsByTermId:{},memberships:[],membershipsByTermId:{}};var t=this.context.getServerTime();return this.$q.all([this.getInternalMembership(),this.getExternalCoursesMembership(),this.updateTermsAndMemberships()]).then((function(s){var n=s[0],o=s[1];e.termsAndMemberships.membershipsByTermId=Object.create(null),e.termsAndMemberships.memberships.splice(0,e.termsAndMemberships.memberships.length),n.forEach((function(r){e.termsAndMemberships.memberships.push(r)})),o.forEach((function(r){e.termsAndMemberships.memberships.push(r)})),e.associateTermsWithCourses(),e.applyTermAvailability();var a=new c.a(e.TermModel,e.termsAndMemberships.terms),m=new l.a(a).map(e.termsAndMemberships.memberships,t);(m=e.applyStudentAvailabilityRules(m)).forEach((function(r){var t=function(t){var s=e.termsAndMemberships.membershipsByTermId[t.id];s||(s=e.termsAndMemberships.membershipsByTermId[t.id]={memberships:[]}),s.memberships.push(r.membership)};t(r.term);var s=r.membership.course.term;!s||r.term!==a.currentTerm&&r.term!==a.upcomingTerm||t(s),e.buildTermRelationships(r)})),Object.keys(e.termsAndMemberships.membershipsByTermId).forEach((function(r){var t=e.termsAndMemberships.membershipsByTermId[r];t.memberships=i.sortBy(t.memberships,(function(e){return e.course.name}))})),r.resolve(e.termsAndMemberships)})),this.loadPromise},e.prototype.getInternalMembership=function(){var e=this,r=this.UserModel.$new(this.contextUser.userId);return this.fetchMemberships(r).then((function(r){return r.forEach((function(e){e.course&&(e.course.term&&(e.course.term.id=e.course.term.$pk),e.course.ui={courseColorClass:m.a(e),courseBannerImage:e.getBannerImageFilename(),courseBannerImageThumbnail:e.getBannerImageThumbnailFilename()})})),e.getActiveMemberships(r)}))},e.prototype.getActiveMemberships=function(e){return e.filter((function(e){return e.course&&e.isAvailable}))},e.prototype.getExternalCoursesMembership=function(){var e=this;return this.ExternalCourseModel.$search({limit:1e4}).$asPromise().then((function(r){return r.map((function(r){return e.parseMembershipFromExternalCourse(r)}))}))},e.prototype.updateTermsAndMemberships=function(){var e=this;return this.TermModel.$search().$asPromise().then((function(r){e.termsAndMemberships.terms=i.orderBy(r,["startDate","durationType"],["asc","desc"]);var t=c.a.decorateTerm(new e.TermModel,u.Mb.ConstantTermId.CurrentTerm.toString()),s=c.a.decorateTerm(new e.TermModel,u.Mb.ConstantTermId.UpcomingTerm.toString());e.termsAndMemberships.terms.push(t,s)}))},e.prototype.associateTermsWithCourses=function(){var e=this;this.termsAndMemberships.memberships.forEach((function(r){r.course.term&&(r.course.term=e.termsAndMemberships.terms.find((function(e){return e.id===r.course.term.id})))}))},e.prototype.applyTermAvailability=function(){this.termsAndMemberships.memberships.forEach((function(e){if(u.o.CourseDuration.UseTerm.isEqualTo(e.course.durationType)){var r=e.course.term;r&&Object.prototype.hasOwnProperty.call(r,"isAvailable")&&(e.course.isHonorTermAvailability?e.course.isAvailable=r.isAvailable:e.course.term.isAvailable||(e.course.isAvailable=!1))}}))},e.prototype.buildTermRelationships=function(e){var r=this.termsAndMemberships.termsByTermId[e.term.id];if(e.membership.course.term){if(e.term.id!==e.membership.course.term.id){if(!r)return void(this.termsAndMemberships.termsByTermId[e.term.id]=[e.membership.course.term]);r.indexOf(e.membership.course.term)<0&&r.push(e.membership.course.term)}}else;this.termsAndMemberships.termsByTermId[e.term.id]=i.orderBy(r,["startDate","name"],["desc","asc"])},e.prototype.applyStudentAvailabilityRules=function(e){return e.filter((function(e){return e.membership.isStudentOrGuestMembership()&&(e.membership.course.isUndecided()?e.membership.course.isAvailable=!1:u.Mb.ConstantTermId.UpcomingTerm.isEqualTo(e.term.id)&&(e.membership.course.isAvailable=!1)),!0}))},e.prototype.getCourseMembership=function(e){var r=this.findCourseMembership(e,this.termsAndMemberships.memberships);if(-1!==r)return this.termsAndMemberships.memberships[r]},e.prototype.findCourseMembership=function(e,r){return r.findIndex((function(r){return r.course.id===e}))},e.prototype.updateCourseUltraStatus=function(e,r){var t=this,s=this.findCourseMembership(e,this.termsAndMemberships.memberships);-1!==s&&(this.termsAndMemberships.memberships[s].course.ultraStatus=r),Object.keys(this.termsAndMemberships.membershipsByTermId).forEach((function(i){-1!==(s=t.findCourseMembership(e,t.termsAndMemberships.membershipsByTermId[i].memberships))&&(t.termsAndMemberships.membershipsByTermId[i].memberships[s].course.ultraStatus=r)}))},e.prototype.filterAssociatedWithTermCourseMembershipsByTerm=function(e,r){return this.filterAssociatedWithTermCourseMemberships(e).filter((function(e){return e.course.term.id===r.id}))},e.prototype.filterAssociatedWithTermCourseMemberships=function(e){return e.filter((function(e){return e.course.term&&!u.o.CourseDuration.Continuous.isEqualTo(e.course.term.durationType)}))},e.prototype.filterAssortedDatesCourseMemberships=function(e){return e.filter((function(e){return null==e.course.term||e.course.term&&u.o.CourseDuration.Continuous.isEqualTo(e.course.term.durationType)}))},e=Object(s.__decorate)([Object(s.__param)(0,Object(d.b)("$q")),Object(s.__param)(1,Object(d.b)("$rootScope")),Object(s.__param)(2,Object(d.b)(a.b)),Object(s.__param)(3,Object(d.b)(u.o.serviceName)),Object(s.__param)(4,Object(d.b)(u.v.serviceName)),Object(s.__param)(5,Object(d.b)(u.Mb.serviceName)),Object(s.__param)(6,Object(d.b)(u.Pb.serviceName)),Object(s.__param)(7,Object(d.b)(u.B.serviceName)),Object(s.__param)(8,Object(d.b)(p.b))],e)}();!function(e){function r(){return null!==e&&e.apply(this,arguments)||this}Object(s.__extends)(r,e)}(f);n.module(h,[a.a,u.Q]).service(b,f)},SY8P:function(e,r,t){var s=t("wHJ2");s.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window","$sce",function(e,r,t){var i=function(r){var t=null,s=[];this.remove=function(r){-1!==s.indexOf(r)&&(s.splice(s.indexOf(r),1),0===s.length&&(e.cancel(t),t=null))},this.add=function(i){-1===s.indexOf(i)&&s.push(i),t||(t=e((function(){var e=s.slice();t=null,s.length=0,e.forEach((function(e){e()}))}),r))}},n=new i(0),o=new i(75);return{restrict:"A",scope:{ngShow:"=",ngBind:"=",ngBindHtml:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",ellipsisSeparator:"@",useParent:"@",ellipsisSeparatorReg:"=",ellipsisFallbackFontSize:"@"},compile:function(e,i,a){return function(e,i,a){function m(){var r=e.ngBind||e.ngBindHtml,n=!1;if(t.isEnabled()&&s.isObject(r)&&t.getTrustedHtml(r)&&(n=!0,r=t.getTrustedHtml(r)),r){var o=!e.ngBind&&!!e.ngBindHtml,m=0,l=void 0!==a.ellipsisSymbol?a.ellipsisSymbol:"&hellip;",c=void 0!==e.ellipsisSeparator?a.ellipsisSeparator:" ",p=void 0!==e.ellipsisSeparatorReg&&e.ellipsisSeparatorReg,d=void 0!==e.ellipsisAppend&&""!==e.ellipsisAppend?l+"<span class='angular-ellipsis-append'>"+e.ellipsisAppend+"</span>":l,h=p?r.match(p):r.split(c);if(a.isTruncated=!1,o?i.html(r):i.text(r),void 0!==a.ellipsisFallbackFontSize&&u(i)&&i.css("font-size",a.ellipsisFallbackFontSize),u(i,e.useParent)){var b=h.length,f=e.useParent?function(e){var r=0;return s.forEach(e.parent().children(),(function(t){t!=e[0]&&(r+=t.clientHeight)})),e.parent()[0].clientHeight-r}(i):i[0].clientHeight;for(o?i.html(r+d):i.text(r).html(i.html()+d),i.attr("data-overflowed","true");m<b;m++){var g=h.pop();if(0===h.length&&(h[0]=g.substring(0,Math.min(g.length,5))),o?i.html(h.join(c)+d):i.text(h.join(c)).html(i.html()+d),(e.useParent?i.parent()[0]:i[0]).scrollHeight<f||!1===u(i,e.useParent)){a.isTruncated=!0;break}}l!=d&&void 0!==e.ellipsisAppendClick&&""!==e.ellipsisAppendClick&&i.find("span.angular-ellipsis-append").bind("click",(function(r){e.$apply((function(){e.ellipsisAppendClick.call(e,{event:r})}))})),!n&&t.isEnabled()&&t.trustAsHtml(r)}else i.attr("data-overflowed","false")}}function u(e,r){return(e=r?e.parent():e)[0].scrollHeight>e[0].clientHeight}function l(){a.lastWindowResizeWidth==window.innerWidth&&a.lastWindowResizeHeight==window.innerHeight||m(),a.lastWindowResizeWidth=window.innerWidth,a.lastWindowResizeHeight=window.innerHeight}a.lastWindowResizeTime=0,a.lastWindowResizeWidth=0,a.lastWindowResizeHeight=0,a.lastWindowTimeoutEvent=null,a.isTruncated=!1,e.$watch("ngShow",(function(){n.add(m)})),e.$watch("ngBind",(function(){n.add(m)})),e.$watch("ngBindHtml",(function(){n.add(m)})),e.$watch("ellipsisAppend",(function(){m()})),e.$watch((function(){return 0!=i[0].offsetWidth&&0!=i[0].offsetHeight}),(function(){o.add(m)}));var c=e.$on("dibari:refresh-ellipsis",(function(){n.add(m)}));function p(){o.add(l)}var d=s.element(r);d.bind("resize",p),e.$on("$destroy",(function(){d.unbind("resize",p),n.remove(m),o.remove(l),c&&(c(),c=null)}))}}}}])},SoDU:function(e,r,t){"use strict";t.d(r,"a",(function(){return n}));var s=t("VdDF"),i=t("pjml"),n=function(){function e(e,r){this.TermModel=e,this.terms=r,this.currentTerm=this.getTerm(i.Mb.ConstantTermId.CurrentTerm.toString()),this.upcomingTerm=this.getTerm(i.Mb.ConstantTermId.UpcomingTerm.toString())}return e.prototype.getTerm=function(e){return this.terms.filter((function(r){return r.id===e}))[0]},e.decorateTerm=function(e,r){return e.id=r,e.ui={type:r},e},e.prototype.createYearTerm=function(e){var r=e.getFullYear(),t="year-"+r,s=this.getTerm(t);return s||((s=new this.TermModel).id=t,s.ui={type:"year",year:r},s.startDate=new Date(r,0),this.addTerm(s)),s},e.prototype.addTerm=function(e){if(e)for(var r=0;r<this.terms.length;r++)if(this.terms[r].startDate>=e.startDate||this.terms[r]===this.currentTerm)return void this.terms.splice(r,0,e)},e.prototype.filterTerm=function(e){return this.terms.filter((function(r){return!!i.Mb.TermDuration.DateRange.isEqualTo(r.durationType)&&s.a.isWithinDateRange(e,{start:r.startDate,end:r.endDate})}))},e}()},lGua:function(e,r,t){var s=t("ziER"),i=t("5JeM"),n=new s({id:"icon-small-settings",use:"icon-small-settings-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-settings"><path d="M7.5977 1.5453c.1998-.2709.6048-.2709.8046 0l.9644 1.307a.5.5 0 00.5534.1798l1.5484-.4906c.3209-.1016.6485.1364.651.473l.0119 1.6242a.5001.5001 0 00.342.4707l1.5411.5133c.3193.1064.4445.4916.2486.7653l-.945 1.321a.5002.5002 0 000 .582l.945 1.321c.1959.2737.0707.6589-.2486.7653l-1.5411.5133a.5.5 0 00-.342.4706l-.0119 1.6243c-.0025.3366-.3301.5746-.651.473L9.92 12.9679a.5.5 0 00-.5533.1798l-.9644 1.307c-.1998.2709-.6048.2709-.8046 0l-.9644-1.307a.5.5 0 00-.5534-.1798l-1.5484.4906c-.3209.1016-.6485-.1364-.651-.473l-.012-1.6243a.4999.4999 0 00-.342-.4706l-1.541-.5133c-.3193-.1064-.4445-.4916-.2486-.7653l.945-1.321a.5.5 0 000-.582l-.945-1.321c-.1959-.2737-.0707-.6589.2486-.7653l1.541-.5133a.5.5 0 00.342-.4707l.012-1.6242c.0025-.3366.3301-.5746.651-.473l1.5484.4906a.5.5 0 00.5534-.1798l.9644-1.307z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M10 8c0 1.1046-.8954 2-2 2s-2-.8954-2-2 .8954-2 2-2 2 .8954 2 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(n);e.exports=n},ptBS:function(e,r,t){var s=t("ziER"),i=t("5JeM"),n=new s({id:"icon-medium-messages",use:"icon-medium-messages-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-messages"><path d="M1 4v16h22V4H1z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M1 4l8.4419 7.6744L12 14l2.5581-2.3256L23 4M23 20c-3.3676-3.5207-5.5754-5.3288-8.4418-8.3256M1 20l8.4419-8.3256" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(n);e.exports=n},q1bP:function(e,r,t){t("wHJ2");t("SY8P"),e.exports="dibari.angular-ellipsis"},vgq2:function(e,r,t){var s=t("ziER"),i=t("5JeM"),n=new s({id:"icon-medium-discussion",use:"icon-medium-discussion-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-discussion"><path d="M8 21.4025a10.4446 10.4446 0 01-1.75-.8072L1 22l1.4318-5.2034C1.5217 15.2417 1 13.4318 1 11.5 1 5.701 5.701 1 11.5 1c4.5718 0 8.4611 2.9218 9.9025 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M9 16c0 3.866 3.134 7 7 7 1.3878 0 2.6812-.3803 3.7692-1.0769L23 23l-1.0769-3.2308C22.6197 18.6812 23 17.3878 23 16c0-3.866-3.134-7-7-7s-7 3.134-7 7z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><circle cx="13" cy="16" r=".5" /><circle cx="16" cy="16" r=".5" /><circle cx="19" cy="16" r=".5" /></symbol>'});i.add(n);e.exports=n},zdqs:function(e,r,t){"use strict";t.d(r,"a",(function(){return o}));var s=t("nsO7"),i=t("VdDF"),n=t("pjml"),o=function(){function e(e){this.termUtil=e,this.membershipTermMapper=new a(this.termUtil)}return e.prototype.getMembershipMapper=function(){return this.membershipTermMapper},e.prototype.map=function(e,r){var t=this;return e.map((function(e){return{membership:e,term:t.membershipTermMapper.adjustTerm(e,r)}}))},e}(),a=function(){function e(e){this.termUtil=e}return e.prototype.adjustTerm=function(e,r){var t=this.getCourseDateRange(e);return t.start>r?e.course.ui.term=this.termUtil.upcomingTerm:i.a.isWithinDateRange(r,t)?e.course.ui.term=this.termUtil.currentTerm:e.course.term?e.course.ui.term=e.course.term:e.course.ui.term=this.getTermMappingBasedOnCourseDates(e,t,r),e.course.ui.term},e.prototype.getCourseDateRange=function(e){var r,t;if(n.o.CourseDuration.DateRange.isEqualTo(e.course.durationType))r=e.course.startDate,t=e.course.endDate;else if(n.o.CourseDuration.FixedNumDays.isEqualTo(e.course.durationType))r=e.enrollmentDate,(t=new Date(e.enrollmentDate.getTime())).setDate(t.getDate()+e.course.numDaysOfUse);else if(n.o.CourseDuration.UseTerm.isEqualTo(e.course.durationType)){var s=e.course.term?this.termUtil.getTerm(e.course.term.id):null;s&&(n.Mb.TermDuration.DateRange.isEqualTo(s.durationType)?(r=s.startDate,t=s.endDate):n.Mb.TermDuration.FixedNumDays.isEqualTo(s.durationType)&&(r=e.enrollmentDate,(t=new Date(e.enrollmentDate.getTime())).setDate(t.getDate()+s.daysOfUse)))}return{end:t,start:r}},e.prototype.getTermMappingBasedOnCourseDates=function(e,r,t){var i=r.start||e.course.term&&e.course.term.startDate;if(!i){if(!(r.end&&t>r.end))return this.termUtil.currentTerm;i=r.end}var n=this.termUtil.filterTerm(i);if(0===n.length)return this.termUtil.createYearTerm(i);if(1===n.length)return n[0];if(n.length>1){var o=s.sortBy(n,["startDate","id"]);return o[o.length-1]}},e}()}}]);