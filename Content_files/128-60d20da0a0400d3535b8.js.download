(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{"0OB5":function(e,t,s){"use strict";s.r(t);s("tvpg");var a=s("wHJ2"),i=s("D57K"),n=(s("GkCm"),s("yC9S")),r=s("43zP"),o=s("4WO5"),c=s("fYJU"),l=s("pjml"),u=s("TnpK"),d="ultra.features.base.profile.privacy.controller",p=function(){function e(e,t,s,a){var i=this;this.$scope=e,this.contextUser=t,this.ultraState=s,this.UserModel=a,this.autoSaveState=r.a.NoChanges,this.privacySettingsInitialState=l.Pb.VisibilityScopeEnum.Nobody,this.userBlocks=[],this.visibilityScopes=l.Pb.VisibilityScopeEnum,this.isSaving=!1,this.confirmClose=!1,this.persist=function(){return i._persist()},this.validate=function(){return!0},this.cancelClicked=function(){i.confirmClose=!0,i.cancel(),i.ultraState.go("base.profile")},this.saveClicked=function(){i.confirmClose=!0,i._persist().finally((function(){i.ultraState.go("base.profile")}))},e.privacy=this,this.user=t.userModel,this.user.blocks.$refresh().$asPromise().then((function(e){i.UserModel.findMany(e.map((function(e){return e.blockedUserId}))).$then((function(e){e.forEach((function(e){return i.userBlocks.push(e)}))}))})),n.b.OnRootScope(this.$scope,"usercard.unblock",(function(e,t){i.userBlocks=i.userBlocks.filter((function(e){return e.id!==t.$pk}))})),this.privacySettingsInitialState=this.user.visibilityScope,this.registerStateChangeListener()}return e.prototype.registerStateChangeListener=function(){var e=this;this.$scope.$on("$stateChangeStart",(function(t,s){s.name.indexOf("update")<0&&!e.confirmClose&&e.user.$getChangedKeys().length>0&&(t.preventDefault(),e.$scope.$broadcast("show-confirmation","user-privacy-settings"))}))},e.prototype._persist=function(){var e=this,t=this.user.visibilityScope&&!l.Pb.VisibilityScopeEnum.Nobody.isEqualTo(this.user.visibilityScope);return this.user.showWorkInfo=t,this.user.showAddressInfo=t,this.user.showEmailInfo=t,this.user.showAddContactInfo=t,this.isSaving=!0,this.user.$patch().$asPromise().then((function(t){return e.$scope.$emit(o.b,t),e.isSaving=!1,e.user}))},e.prototype.cancel=function(){return this.user.visibilityScope=this.privacySettingsInitialState,this.user.$patch().$asPromise()},e.$inject=["$scope",c.b,u.d,l.Pb.serviceName],e}(),b=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(i.__extends)(t,e)}(p),s("Sgjf")),v=s("OdCm");s.d(t,"moduleName",(function(){return h})),s.d(t,"controllerName",(function(){return m})),s.d(t,"template",(function(){return v}));var h="ultra.features.base.profile.privacy",m=d;a.module(h,[b.a,l.Q,u.b]).controller(d,p)},OdCm:function(e,t){e.exports='<div id="profile-privacy" class="side-panel">\n  <form bb-autosave save-func="privacy.persist()" validation-func="privacy.validate()" class="basic-profile-form">\n    <div class="panel-wrap privacy-settings has-footer" bb-foundation="">\n      <header class="panel-header simple-header">\n        <div class="panel-titles-container">\n          <span class="panel-sub-title" bb-translate>base.profile.peekPanelSubtitle</span>\n          <div class="black-header-contents">\n            <button class="left-off-canvas-toggle menu-toggle standard-button dark-background"\n                    type="button"\n                    analytics-id="features.base.profile.privacy.menu.button">\n              <bb-svg-icon size="small" icon="main-menu"></bb-svg-icon>\n              <span class="sr-only" bb-translate>base.profile.menu</span>\n            </button>\n            <h1 class="panel-title" bb-translate>base.profile.updatePrivacySettings.pageTitle</h1>\n          </div>\n        </div>\n      </header>\n      <fieldset class="fieldset-privacy">\n        <div class="panel-content panel-content-inner">\n          <div class="panel-info">\n            <legend class="legend-privacy"><span bb-translate>base.profile.updatePrivacySettings.instructions</span></legend>\n          </div>\n          <div>\n            <div class="panel-options">\n              <input type="radio" name="privacySettings" id="privacy-hidden"\n                     ng-model="privacy.user.visibilityScope" ng-value="privacy.visibilityScopes.Nobody"\n                     analytics-id="features.base.profile.privacy.visibility.nobody.input.radio"/>\n              <label ng-if="privacy.user.isInstructor()" for="privacy-hidden" bb-translate>base.profile.updatePrivacySettings.instructors.noOne</label>\n              <label ng-if="!privacy.user.isInstructor()" for="privacy-hidden" bb-translate>base.profile.updatePrivacySettings.others.noOne</label>\n            </div>\n\n            <div class="panel-options">\n              <input type="radio" name="privacySettings" id="privacy-classmates" ng-init="checked=true;"\n                     ng-model="privacy.user.visibilityScope" ng-value="privacy.visibilityScopes.Classmates"\n                     analytics-id="features.base.profile.privacy.visibility.classmates.input.radio"/>\n              <label class="js-instructor-privacy-course-visible" ng-if="privacy.user.isInstructor()" for="privacy-classmates" bb-translate>base.profile.updatePrivacySettings.instructors.myClassmates</label>\n              <label class="js-non-instructor-privacy-course-visible" ng-if="!privacy.user.isInstructor()" for="privacy-classmates" bb-translate>base.profile.updatePrivacySettings.others.myClassmates</label>\n            </div>\n            <div class="panel-options">\n              <input type="radio" name="privacySettings" id="privacy-school"\n                     ng-model="privacy.user.visibilityScope" ng-value="privacy.visibilityScopes.School"\n                     analytics-id="features.base.profile.privacy.visibility.school.input.radio"/>\n              <label ng-if="privacy.user.isInstructor()" for="privacy-school" bb-translate>base.profile.updatePrivacySettings.instructors.mySchool</label>\n              <label ng-if="!privacy.user.isInstructor()" for="privacy-school" bb-translate>base.profile.updatePrivacySettings.others.mySchool</label>\n            </div>\n          </div>\n        </div>\n      </fieldset>\n    </div>\n    <div class="spinner bb-secondary-color-2" ng-if="privacy.isSaving"></div>\n    <bb-save-buttons validate-save="privacy.validate()"\n                     save-action="privacy.saveClicked()"\n                     cancel-action="privacy.cancelClicked()"\n                     can-delete="false"\n                     display-delete-after-saving="true"\n                     analytics-id-tag-prefix="features.base.profile.privacy">\n    </bb-save-buttons>\n  </form>\n  <div class="hide"\n       bb-confirmation-needed="x-bb-close-without-saving"\n       modal-name="user-privacy-settings"\n       show-type="always"\n       ng-click="privacy.cancelClicked()"\n       analytics-id="features.base.profile.privacy.visibility.cancelChanges">\n  </div>\n</div>'},Sgjf:function(e,t,s){"use strict";s.d(t,"a",(function(){return f}));var a=s("D57K"),i=(s("Zeij"),s("ptBS"),s("SSV0"),s("5iHu")),n=s("wHJ2"),r=s("jciN"),o=s("0JpG"),c=s("fYJU"),l=s("pjml"),u=s("+4Px"),d=s("OvxF"),p=s("lUN/"),b=s("TnpK"),v=s("qeC2"),h=s("aHpC"),m=s("nmzr"),f="ultra.components.directives.usercard",g=function(){function e(e,t,s,a,i,n,r,o,c,l){this.$modal=e,this.$q=t,this.scope=s,this.element=a,this.attrs=i,this.bbLocalize=n,this.CourseModel=r,this.contextUser=o,this.$userModelService=c,this.ultraState=l,this.current=this.contextUser.userModel,null==this.scope.autoUpdate&&(this.scope.autoUpdate=!0),this.scope.showcard=!1,p.a(),this.$userModelService.$mixHook("after-save",(function(){this.id===s.user.id&&(s.userNames={givenName:this.givenName,familyName:this.familyName})}),s)}return e.prototype.canSendMessage=function(){var e=this.scope.canSendMessage;return!e||e()},e.prototype.hasDueDateException=function(){var e=this.scope.hasDueDateException;return!!e&&e()},e.prototype.canEditDueDateException=function(){var e=this.scope.canEditDueDateException;return!!e&&e()},e.prototype.sendMessage=function(){this.ultraState.goPeekState(this.getMessagePeekState(),{courseId:this.scope.courseId,recipientIds:this.scope.user.id})},e.prototype.getMessagePeekState=function(){return this.scope.messagePeekState||m.CourseRoutes.COURSE_MESSAGE},e.prototype.getUserNameLabel=function(){return this.userName=this.scope.userNames,this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.usercard.ariaButtonLabel",params:{user:this.userName},noWrap:!0,noEscape:!0})},e.prototype.keyDown=function(e){if(e.keyCode===u.t&&e.preventDefault(),this.scope.showcard){var t=!1;if(e.keyCode===u.g)t=!0;else if(e.keyCode===u.u){var s=i(".usercard").find(":tabbable");t=s.length<1||(!(!e.shiftKey||!i(".usercard-clickable").is(":focus"))||(e.shiftKey?document.activeElement===s[0]:document.activeElement===s[s.length-1]))}t&&(e.stopImmediatePropagation(),this.hide())}},e.prototype.hide=function(){this.scope.showcard&&(this.scope.showcard=!1,this.toggleFloatingContainer(),this.element.find(".usercard-trigger").focus())},e.prototype.show=function(){this.scope.showcard=!!this.canShow(),this.toggleFloatingContainer()},e.prototype.toggleFloatingContainer=function(){i(".floating-column-container").css("overflow",this.scope.showcard?"visible":"hidden")},e.prototype.canShow=function(){return!!this.scope.user&&!!this.scope.user.id&&!this.isSameUser()},e.prototype.isSameUser=function(){return!(!this.current||!this.scope.user)&&this.scope.user.id===this.current.id},e.prototype.getCourseRoleLocalizeId=function(){return this.scope.inactive&&this.scope.inactive()?this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.usercard.unavailable"}):this.scope.courseRole()},e.prototype.sendMessageViaSpaceBar=function(e){this.scope.showcard&&e.keyCode===u.t&&(e.stopPropagation(),this.sendMessage())},e.$inject=["$modal","$q","scope","element","attrs",o.serviceName,l.o.serviceName,c.b,l.Pb.serviceName,b.d],Object(a.__decorate)([Object(h.d)("locale","userNames")],e.prototype,"getUserNameLabel",null),e}(),y=function(){function e(e,t,s){var a=this;this.$injector=e,this.bbLocalize=t,this.ultraState=s,this.restrict="E",this.template=v,this.scope={user:"=",panel:"@?",courseId:"@",messagePeekState:"@?",courseRole:"&",usercardShow:"@",recipientIds:"=",canSendMessage:"&?",hasDueDateException:"&?",canEditDueDateException:"&?",membershipId:"=?",inactive:"&?",autoUpdate:"=?"},this.link=function(e,t,s){e.attr=s,e.bbUsercard=a.$injector.instantiate(g,{scope:e,element:t,attrs:s}),e.user&&(e.userName=a.bbLocalize.formatUsernameSync(e.user,o.ILocaleUsernameFormat.Short,e,{noWrap:!0}),e.userNames=e.user)}}return e.$inject=["$injector",o.serviceName],e}();n.module(f,[r.a,o.moduleName,l.Q,c.a,d.a,b.b]).directive("bbUsercard",["$injector",function(e){return e.instantiate(y)}])},Zeij:function(e,t,s){},ptBS:function(e,t,s){var a=s("ziER"),i=s("5JeM"),n=new a({id:"icon-medium-messages",use:"icon-medium-messages-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-messages"><path d="M1 4v16h22V4H1z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M1 4l8.4419 7.6744L12 14l2.5581-2.3256L23 4M23 20c-3.3676-3.5207-5.5754-5.3288-8.4418-8.3256M1 20l8.4419-8.3256" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(n);e.exports=n},qeC2:function(e,t){e.exports='<div bb-load-bundle="components/directives/usercard" bb-cache-compilation="user-card" title="{{::userName}}">\n\n    <div ng-if="user.ui.anonymousStudent" class="anonymous-student-avatar">\n      <bb-avatar user="user" role="presentation" auto-update="::autoUpdate" inactive="inactive()"></bb-avatar>\n    </div>\n\n    <div ng-if="!user.ui.anonymousStudent"\n         ng-click="bbUsercard.show()"\n         ng-keydown="bbUsercard.keyDown($event)"\n         ng-mouseleave="bbUsercard.hide()"\n         tabindex="{{::bbUsercard.canShow() ? 0 : -1}}"\n         class="usercard-trigger"\n         ng-class="::{\'usercard-clickable\': bbUsercard.canShow(), \'usercard-not-clickable\': !bbUsercard.canShow()}"\n         role="button"\n         aria-haspopup="true"\n         aria-expanded="{{showcard}}"\n         aria-label="{{bbUsercard.getUserNameLabel()}}"\n         analytics-id="components.directives.usercard.showCard"\n    >\n        <div ng-switch="usercardShow" tabindex="-1">\n            <span ng-switch-when="username" class="usercard-button">\n                <bb-username class="name-title" user="user" ng-attr-format="{{attr.format}}" auto-update="{{autoUpdate}}"\n                             ng-class="{ inactive: inactive() }"></bb-username>\n            </span>\n            <span ng-switch-when="avatar" class="usercard-button">\n                <bb-avatar user="user" role="presentation" auto-update="::autoUpdate"\n                  inactive="inactive()"></bb-avatar>\n            </span>\n            <span ng-switch-when="combined" class="usercard-button">\n              <bb-avatar user="user" role="presentation" auto-update="::autoUpdate" inactive="inactive()"></bb-avatar>\n              <bb-username user="user" format="short" auto-update="::autoUpdate" ng-class="{ inactive: inactive() }"></bb-username>\n            </span>\n            <span ng-switch-when="outline" class="usercard-button">\n                <bb-avatar user="user" role="presentation" auto-update="::autoUpdate" inactive="inactive()"></bb-avatar>\n                <div class="element-details">\n                  <div class="name ellipsis">\n                      <bb-username user="user" format="short" auto-update="::autoUpdate" ng-class="{ inactive: inactive() }"></bb-username>\n                  </div>\n                  <div class="content ellipsis">\n                    <p class="user-name js-course-role" bb-translate>{{bbUsercard.getCourseRoleLocalizeId()}}</p>\n                  </div>\n                </div>\n            </span>\n        </div>\n        <div ng-if="showcard" bb-click-outside="bbUsercard.hide()" is-active="showcard"\n             class="element-card usercard usercard-not-clickable" ng-class="{\'showcard\': showcard }" bb-focus>\n            <div class="header">\n                <bb-avatar user="user" ng-attr-auto-update="::autoUpdate" inactive="inactive()"></bb-avatar>\n                <div class="element-details">\n                    <div class="name">\n                        <bb-username class="name-title" user="user" ng-class="{ inactive: inactive() }"\n                                     ng-attr-format="{{attr.format}}" ng-attr-auto-update="{{::autoUpdate}}"></bb-username>\n                    </div>\n                  <div class="userId ellipse" ng-if="user.userName && !user.studentId" title="{{user.userName}}">{{user.userName}}</div>\n                  <div class="userId ellipse" ng-if="!user.userName && user.studentId" bb-translate translate-values="{ studentId: user.studentId }">components.directives.usercard.studentId</div>\n                  <div class="userId ellipse" ng-if="user.userName && user.studentId" bb-translate translate-values="{ username: user.userName, studentId: user.studentId }">components.directives.usercard.usernameAndId</div>\n                  <div class="profile ellipsis" bb-translate>{{bbUsercard.getCourseRoleLocalizeId()}}</div>\n                    <div class="profile exception-link" ng-if="bbUsercard.hasDueDateException()">\n                      <div class="clickable ellipsis" ng-if="bbUsercard.canEditDueDateException()" bb-translate bb-peek-sref="accommodation({membershipId: membershipId})">\n                        components.directives.usercard.studentExceptions\n                      </div>\n                      <span ng-if="!bbUsercard.canEditDueDateException()" bb-translate>\n                        components.directives.usercard.studentExceptions\n                      </span>\n                    </div>\n                </div>\n            </div>\n            <div class="buttons">\n              \x3c!-- I don\'t use one time binding, as user can open a peek panel to config this attribute. This configuration has to take effect immediately--\x3e\n              <button aria-hidden="{{!showcard}}" ng-if="bbUsercard.canSendMessage()"\n                      type="button"\n                      ng-click="bbUsercard.sendMessage()"\n                      class="button large clear mail-button"\n                      title="{{user.mail}}"\n                      bb-translate-attrs="{\'aria-label\': \'components.directives.usercard.sendMessage\'}"\n                      tabindex="{{showcard ? 0 : -1}}"\n                      ng-keydown="bbUsercard.sendMessageViaSpaceBar($event)"\n                      analytics-id="components.directives.usercard.sendMessage.button"\n              >\n                <bb-svg-icon size="medium" icon="messages"></bb-svg-icon>\n              </button>\n            </div>\n        </div>\n    </div>\n\n</div>\n'},tvpg:function(e,t,s){}}]);